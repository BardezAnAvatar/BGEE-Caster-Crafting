/****************************************************************
*   This file will handle the creation of *.ITM resources       *
*       for the new potions I want to create. It will be        *
*       driven off of my registry metadata, with exception      *
*       cases created more explicitly.                          *
*                                                               *
*   Precondition:                                               *
*       - Associative array ~new_potions_spells_items~ exists   *
*       and is populated                                        *
****************************************************************/


ACTION_PHP_EACH ~new_potions_spells_items~
    AS ~keys~ => ~value~
    BEGIN
        PRINT ~DEBUG: Olvyn:
            Value:      `%value%`;
            SRC BAM:    `%keys_10%`;
            Dest BAM:   `%keys_11%`;
            DESC BAM:   `%keys_12%`;~

        /****************
        *   Copy BAMs   *
        ****************/
        //copy inventory BAM
        COPY
            ~./%MOD_FOLDER%/comp/missing-potions/BAM/inv/%keys_10%~
            ~override/%keys_11%.BAM~

        //copy description BAM
        ACTION_IF NOT FILE_EXISTS ~./override/%keys_12%.BAM~
        THEN BEGIN
            COPY
                ~./%MOD_FOLDER%/comp/missing-potions/BAM/desc/%keys_12%.BAM~
                ~override/%keys_12%.BAM~
        END
        /*********************
        *   END: Copy BAMs   *
        *********************/



        /********************************
        *    BEGIN: Read Source Spell   *
        ********************************/
        //Read the extended header for copying
        //Read the duration for description
            //if the specified opcode is missing or the opcode is empty, should be "0"
            //clouds and such have no SPL duration, but their projectiles do:
                //The total duration is generally Frequency * # Repetitions. Frerquency is in ticks; 100 = 1 round (different time scale :-/ )
        //Read the specified op code for magnitide?
        //Read the specified op code for magnitude2?
        //TODO: after reading duration, emit a value that does days; hours; turns (rounds);rounds; seconds; instant
        /******************************
        *    END: Read Source Spell   *
        ******************************/



        /***************************************
        *    BEGIN: Item Description Strings   *
        ***************************************/
        /*
            Expect these values variables:
                TODO:
                    %duration%;
                        NEW
                %magnitude%
                    Fly
                    Snilloc's
                    Searing Smite
                    Armor of Faith
                    Barkskin
                    Draw Upon Holy Might
                    Mirror Image
                    Fireball
                    Holy Power
                    Spirit Fire
                    Stoneskin
                    Champion's Strength
                    Righteous Magic
                    Tenser's Transformation
                    Chain Lightning
                %magnitude2%
                    Holy Power
                    Righteous Magic
        */
        /*************************************
        *    END: Item Description Strings   *
        *************************************/



        /******************************
        *    BEGIN: Create ITM file   *
        ******************************/
        //TODO: Copy item base
        //Apply header
        // Is it Targeting self, a point, or an opponent?

        //All headers are magical. Use the target metadata for the target flag.
        /****************************
        *    END: Create ITM file   *
        ****************************/



        /******************************
        *    BEGIN: Hard-coded ITMs   *
        ******************************/
        //TODO: ITMs that automation won't work for:
        /*
            Find Traps
        */
        /****************************
        *    END: Hard-coded ITMs   *
        ****************************/
    END
